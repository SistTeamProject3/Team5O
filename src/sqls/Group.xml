<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Group">

<insert id="group_make" parameterType="sist.co.model.GroupMakeDTO">
INSERT INTO TP3_MAKEGROUP(G_SEQ,G_NAME,G_TYPE,G_MANAGER)
VALUES(TP3_GROUP_SEQ.NEXTVAL,#{g_name},#{g_type},#{g_manager})

</insert>

<select id="select_make_group" parameterType="sist.co.model.GroupMakeDTO" resultType="sist.co.model.GroupMakeDTO">
SELECT * FROM TP3_MAKEGROUP
WHERE G_MANAGER=#{g_manager} AND G_SEQ=(SELECT MAX(G_SEQ) FROM TP3_MAKEGROUP)
</select>
<insert id="add_group_manager" parameterType="sist.co.model.GroupMemberDTO">
INSERT INTO TP3_GROUPMEMBER
VALUES(#{g_seq},#{m_id},3)
</insert>

<select id="group_list" parameterType="sist.co.model.GroupListDTO" resultType="sist.co.model.GroupListDTO">

SELECT A.G_SEQ,A.M_ID,A.G_AUTH,B.G_NAME,B.G_PHOTO,B.G_TYPE,B.G_MANAGER 
FROM TP3_GROUPMEMBER A,TP3_MAKEGROUP B
WHERE A.G_SEQ=B.G_SEQ AND M_ID=#{m_id}
</select>

<select id="group_detail" parameterType="sist.co.model.GroupMakeDTO" resultType="sist.co.model.GroupMakeDTO">
SELECT * FROM TP3_MAKEGROUP
WHERE G_SEQ=#{g_seq}
</select>

<select id="group_mem_list" parameterType="sist.co.model.GroupMakeDTO" resultType="sist.co.model.GroupMemberListDTO">
SELECT TP3_SISTMEMBER.M_ID,m_name, m_nickname, m_highschool, m_university, m_office, m_address,m_profile, g_seq, g_auth
FROM TP3_SISTMEMBER
INNER JOIN TP3_GROUPMEMBER 
ON TP3_SISTMEMBER.M_ID=TP3_GROUPMEMBER.M_ID
WHERE G_SEQ=#{g_seq} AND M_NAME LIKE '%'||#{keyword}||'%'

</select>

<select id="group_mem_admin_list" parameterType="sist.co.model.GroupMakeDTO" resultType="sist.co.model.GroupMemberListDTO">
SELECT TP3_SISTMEMBER.M_ID,m_name, m_nickname, m_highschool, m_university, m_office, m_address,m_profile, g_seq, g_auth
FROM TP3_SISTMEMBER
INNER JOIN TP3_GROUPMEMBER 
ON TP3_SISTMEMBER.M_ID=TP3_GROUPMEMBER.M_ID
WHERE G_SEQ=#{g_seq} AND G_AUTH=3 AND M_NAME LIKE '%'||#{keyword}||'%'
</select>

<select id="group_mem_reply_list" parameterType="sist.co.model.GroupMakeDTO" resultType="sist.co.model.GroupMemberListDTO">
SELECT TP3_SISTMEMBER.M_ID,m_name, m_nickname, m_highschool, m_university, m_office, m_address,m_profile, g_seq, g_auth
FROM TP3_SISTMEMBER
INNER JOIN TP3_GROUPMEMBER 
ON TP3_SISTMEMBER.M_ID=TP3_GROUPMEMBER.M_ID
WHERE G_SEQ=#{g_seq} AND G_AUTH=2 AND M_NAME LIKE '%'||#{keyword}||'%'
</select>

<select id="group_mem_block_list" parameterType="sist.co.model.GroupMakeDTO" resultType="sist.co.model.GroupMemberListDTO">
SELECT TP3_SISTMEMBER.M_ID,m_name, m_nickname, m_highschool, m_university, m_office, m_address,m_profile, g_seq, g_auth
FROM TP3_SISTMEMBER
INNER JOIN TP3_GROUPMEMBER 
ON TP3_SISTMEMBER.M_ID=TP3_GROUPMEMBER.M_ID
WHERE G_SEQ=#{g_seq} AND G_AUTH=0 AND M_NAME LIKE '%'||#{keyword}||'%'
</select>



</mapper>

